<?php
namespace Kyrne\Shout\Api\Controllers; use Flarum\Api\Controller\AbstractShowController; use Flarum\Http\AccessToken; use Illuminate\Support\Arr; use Kyrne\Shout\Api\Serializers\KeySerializer; use Kyrne\Shout\Encryption; use Psr\Http\Message\ServerRequestInterface; use Tobscure\JsonApi\Document; class GetIdentityController extends AbstractShowController { public $serializer = KeySerializer::class; protected function data(ServerRequestInterface $spc1c877, Document $spb8026c) { $spd5a94c = Arr::get($spc1c877->getQueryParams(), 'id'); $spd4bab0 = $spc1c877->getAttribute('actor'); if (intval($spd5a94c) === intval($spd4bab0->id)) { return Encryption::where('user_id', $spd4bab0->id)->firstOrFail(); } else { $sp953fd1 = Encryption::where('user_id', $spd5a94c)->firstOrFail(); $sp953fd1->identity_key = null; $sp953fd1->prekey = json_decode($sp953fd1->prekeys)[$sp953fd1->prekey_index]; $sp953fd1->prekeys = null; return $sp953fd1; } } }